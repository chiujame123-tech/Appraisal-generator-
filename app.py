import streamlit as st

# ==========================================
# 1. 建立 FS-278 評分指標資料庫 (已食入全部16項資料)
# ==========================================
fs278_db = {
    "1. 工作認識": {
        "優 (A)": {"行動": "極之熟悉分區內的各特別風險及其緊急應變計劃，對分局內各樓宇的消防設施及裝置極之熟悉，對所有滅火拯救工具的運用都瞭如指掌，並了解現時先進的滅火常識及未來消防工程的發展。", "局內": "熟讀部門的各項公文，包括常務訓令及各消防事務手冊。對部門的新發展非常熟悉，並精通各項行政與工作程序。"},
        "良 (B)": {"行動": "十分熟知分局內的各特別風險及其緊急應變計劃，對各樓宇的消防設施有充分了解，對局內各種拯救工具十分熟悉。", "局內": "對部門的各項公文有深厚的認識，十分熟悉各項行政工作程序，並密切留意部門的新發展。"},
        "常/當 (C)": {"行動": "認識分局內的各特別風險及其緊急應變計劃，對局內各種滅火拯救工具有一定的認識。", "局內": "對部門的各項公文有一定的認識，對個別行政程序有基本了解。"}
    },
    "2. 行動效率/專業能力": {
        "優 (A)": {"行動": "在無需監督下，能非常迅速、有效地完成工作，處事能作多方面思考並常常給予上級多個可行建議，充分顧及團隊及公眾安全。", "局內": "在各種操練中表現傑出，能即時糾正其他隊員的錯誤，更能建議上級各種不同操練的形式與情景。"},
        "良 (B)": {"行動": "在無需監督下，能迅速有效地完成工作，經常能給予上級確切可行的建議。", "局內": "在各種操練中表現良好，能對基本操練提出改善建議。"},
        "常/當 (C)": {"行動": "在有限的監督下，能迅速有效地完成工作，偶而給予上級建議。", "局內": "在基本操練中表現良好。"}
    },
    "3. 承擔責任": {
        "優 (A)": {"行動": "極之積極接受各類型工作，如主動尋找火源及調查成因。", "局內": "極之積極承擔局內工作，除了管理得井井有條外，更能作出改善建議。"},
        "良 (B)": {"行動": "積極接受各類型工作。", "局內": "積極承擔局內各項工作並管理得當。"},
        "常/當 (C)": {"行動": "接受並妥善完成簡單的行動工作。", "局內": "在上級委派下承擔局內工作並管理得當。"}
    },
    "4. 可靠程度": {
        "優 (A)": {"通用": "多次工作皆能非常準確無誤地在指定時間內完成，並定期作出滙報，深得各級同事信賴。"},
        "良 (B)": {"通用": "每項工作皆能準確無誤地完成，並定期作出滙報，深得上級認同。"},
        "常/當 (C)": {"通用": "每項工作皆能完成並定期滙報。"}
    },
    "5. 領導才能": {
        "優 (A)": {"行動": "能夠協助現場總指揮，恰當地分配工作，調派及帶領各分隊有效地執行任務，並全面照顧隊員安全。", "局內": "能夠帶領局內各類型的操練，即時糾正同事錯誤，並主動協助分隊主管妥善管理局內大小事務。"},
        "良 (B)": {"行動": "能帶領分隊有效地執行上級委派的工作，照顧隊員安全。", "局內": "能協助主管處理各項事務，分析隊員長劣並調派得妥，令工作更有效率。"},
        "常/當 (C)": {"行動": "能帶領分隊執行工作，照顧小隊安全。", "局內": "能夠帶領局內各類型的基本操練。"}
    },
    "6. 服從紀律": {
        "優 (A)": {"通用": "聽從上級指令，非常迅速有效地執行各項任務。嚴格遵從部門訓令，並能適時提醒其他隊員遵從。"},
        "良 (B)": {"通用": "聽從上級指令，正確執行各項任務，遵從各項部門訓令。"},
        "常/當 (C)": {"通用": "聽從指令執行任務並遵從規例。"}
    },
    "7. 幹勁與決心": {
        "優 (A)": {"通用": "能為自己及其他隊員訂立各種目標及落實執行時間，追求卓越，非常積極學習新的消防知識以充實自己。"},
        "良 (B)": {"通用": "能為自己訂立目標，願意學習新的消防知識。"},
        "常/當 (C)": {"通用": "能為自己訂立目標及接受新知識。"}
    },
    "8. 面對壓力的表現": {
        "優 (A)": {"行動": "於任何惡劣環境下仍能細心聽從上級指令並迅速完成，能冷靜處理突發事故，清楚滙報現場狀況。", "局內": "面對群眾時能清楚自信地作工具介紹或防火講座；在模擬事故中能十分迅速有效地處理突發情況。"},
        "良 (B)": {"行動": "於惡劣環境下仍能聽從指令並有效地完成，能處理各項突發事故。", "局內": "面對群眾時能作各種工具介紹；在模擬事故中能冷靜處理突發情況。"},
        "常/當 (C)": {"行動": "於惡劣環境下能聽從指令並完成任務。", "局內": "面對群眾時能作簡單的工具介紹及防火講座。"}
    },
    "9. 積極主動": {
        "優 (A)": {"行動": "經常主動向主管提出確切可行的建議，主動協助其他同事完成職務，並起到協調各單位的角色。", "局內": "經常主動向年青隊員教授消防工具的使用，察覺問題會立刻跟進，並主動對局內事情提出建設性改善建議。"},
        "良 (B)": {"行動": "能向主管提出確切可行的建議，主動接受並妥善完成委派任務。", "局內": "主動向年青隊員教授使用消防工具，察覺問題會立刻要求跟進並時常巡查局內地方。"},
        "常/當 (C)": {"行動": "接受上級委派的任務並能完成。", "局內": "被請教時願意教授年青隊員使用工具。"}
    },
    "10. 分析能力": {
        "優 (A)": {"通用": "能敏銳監察並留意行動中潛在的各種風險，向上級建議解決方法；亦能準確分析各隊員的長劣並加以發揮。"},
        "良 (B)": {"通用": "能監察並留意行動中潛在的各種風險，並滙報予上級。"},
        "常/當 (C)": {"通用": "偶而能監察並留意行動中潛在的風險並滙報。"}
    },
    "11. 判斷能力": {
        "優 (A)": {"行動": "處理救援工作時能根據緩急輕重，非常迅速判斷出先後次序，並於變化環境中審時度勢作出相應調整。", "局內": "處理局內工作時能準確無誤地判斷出處理的先後次序。"},
        "良 (B)": {"行動": "能根據事情緩急輕重判斷處理次序，於變化環境中在上級領導下作出調整。", "局內": "能根據事情緩急輕重判斷局內工作的先後次序。"},
        "常/當 (C)": {"行動": "能判斷出處理先後次序。", "局內": "能判斷出局內工作的處理次序。"}
    },
    "12. 組織能力": {
        "優 (A)": {"行動": "能因應現場策略目標，靈活有系統地調派各小分隊工作。", "局內": "能有條理地管理各種局內事宜，紀錄清晰，並不斷提出改善建議。"},
        "良 (B)": {"行動": "能因應任務目標，靈活有系統地調派自己分隊工作。", "局內": "能有條理地管理局內事宜及紀錄清晰。"},
        "常/當 (C)": {"行動": "能協助自己分隊完成工作。", "局內": "能管理局內事宜，紀錄清楚。"}
    },
    "13. 溝通能力": {
        "優 (A)": {"行動": "使用無線電時能非常清晰簡潔地傳達信息。", "局內": "在防火講座及面對參觀人士時講解極之清晰、生動有趣及自信。在會議中清楚表達意見，並能用文字精準記錄運作過程。"},
        "良 (B)": {"行動": "使用無線電時能十分清晰簡潔地傳達信息。", "局內": "面對參觀人士時講解清晰及信心十足，介紹工具時條理分明。"},
        "常/當 (C)": {"行動": "能清晰地傳達無線電信息。", "局內": "面對到訪人士時能簡單介紹局內運作。"}
    },
    "14. 儀容和舉止": {
        "優 (A)": {"通用": "經常保持極良好的儀容和舉止。"},
        "良 (B)": {"通用": "經常保持良好的儀容和舉止。"},
        "常/當 (C)": {"通用": "儀容和舉止恰當。"}
    },
    "15. 與人相處的技巧": {
        "優 (A)": {"通用": "擁有極佳與人相處的技巧，平易近人，能與同事建立深厚互信，在局內營造出和諧氣氛。"},
        "良 (B)": {"通用": "與人相處融洽，能與同事建立良好關係。"},
        "常/當 (C)": {"通用": "能與同事和睦相處。"}
    },
    "16. 支持/參加部門活動": {
        "優 (A)": {"通用": "非常積極參與及支持部門活動，並協助上級籌備。"},
        "良 (B)": {"通用": "積極參與並支持部門活動。"},
        "常/當 (C)": {"通用": "積極支持部門活動，如到場打氣等。"}
    }
}

# ==========================================
# 介面設置
# ==========================================
st.set_page_config(page_title="消防考績系統", layout="wide")
st.title("🚒 消防人員考績系統 (FS-278)")

# 建立兩個 Tabs (標籤頁)
tab1, tab2 = st.tabs(["📝 考績生成器 (Generator)", "📚 舊料資料庫 (Database)"])

# ==========================================
# TAB 1: 考績生成器
# ==========================================
with tab1:
    st.info("請填寫基本資料並選擇各項評級，系統會自動將「行動」與「局內」表現分段成文。")
    
    # 基本資料
    col1, col2, col3, col4 = st.columns(4)
    with col1: member_name = st.text_input("人員姓名", "王國良")
    with col2: member_rank = st.selectbox("職級", ["消防隊目", "消防總隊目", "消防員"])
    with col3: overall_rating = st.selectbox("整體評級", ["優 (A)", "良 (B)", "常/當 (C)"])
    with col4: future_plan = st.text_input("未來動向/建議訓練", "參加煙火特攻員訓練課程")

    st.markdown("### 📊 FS-278 評分細項")
    
    # 使用 st.expander 把 16 個下拉選單收納起來，讓版面不至於太長
    with st.expander("點擊展開/收起 16項評分設定", expanded=True):
        c1, c2, c3, c4 = st.columns(4)
        selections = {}
        
        # 分配 16 個項目到 4 個 Column 顯示
        items_list = list(fs278_db.keys())
        for i, item in enumerate(items_list):
            col_target = [c1, c2, c3, c4][i % 4]
            with col_target:
                selections[item] = st.selectbox(item, ["優 (A)", "良 (B)", "常/當 (C)"], key=f"sel_{i}")

    st.markdown("### 📝 具體事故案例補充 (行動表現段落)")
    specific_case = st.text_area(
        "請簡述一個具體行動案例（將插入至行動段落末端加強說服力）", 
        "例如於二零二四年四月十日在佐敦道華豐大廈發生的三級火警中，當日作為升降台隊目並以搜救隊身份執行任務。臨危不亂，有條理及清晰地指派各隊員執行任務，最終成功救出被困人士。"
    )
    
    events_input = st.text_input("近期參與的部門活動 (第16項補充)", "油尖旺社區應急防火嘉年華2024")

    # === 生成邏輯 ===
    if st.button("🚀 一鍵生成考績報告", type="primary", use_container_width=True):
        
        # 初始化段落文字庫
        para1_traits = [] # 個人特質與紀律 (通用)
        para2_ops = []    # 行動職務
        para3_sta = []    # 局內工作
        para4_misc = []   # 部門活動與總結

        # 遍歷 16 個項目，根據結構拆分
        for item_name, grade in selections.items():
            content = fs278_db[item_name][grade]
            
            # 分類邏輯
            if "行動" in content:
                para2_ops.append(content["行動"])
            if "局內" in content:
                para3_sta.append(content["局內"])
                
            if "通用" in content:
                # 判斷放入哪一段
                if item_name in ["4. 可靠程度", "6. 服從紀律", "7. 幹勁與決心", "10. 分析能力", "14. 儀容和舉止", "15. 與人相處的技巧"]:
                    para1_traits.append(content["通用"])
                elif item_name == "16. 支持/參加部門活動":
                    para4_misc.append(content["通用"])

        # 組合文章
        p1_text = f"【個人特質與紀律】\n{member_rank}{member_name}對工作盡忠職守。{'此外，'.join(para1_traits)}"
        p2_text = f"【行動工作表現】\n在行動工作方面，{member_name[0]}{member_rank[-2:]}表現卓越。{''.join(para2_ops)}這點在他處理實際事故時表露無遺。{specific_case}"
        p3_text = f"【局內工作表現】\n在局內工作方面，{member_name[0]}{member_rank[-2:]}極之能幹可靠。{''.join(para3_sta)}"
        p4_text = f"【總結與未來動向】\n{member_name[0]}{member_rank[-2:]}{para4_misc[0]}例如參與{events_input}。整體來說，他在評核期內各方面工作表現令人滿意，故此我把他的表現評為「{overall_rating.split(' ')[0]}」級。在訓練方面，我建議他{future_plan}。"

        final_text = f"{p1_text}\n\n{p2_text}\n\n{p3_text}\n\n{p4_text}"
        
        st.success("✅ 報告生成成功！")
        st.text_area("📋 複製您的考績報告：", final_text, height=450)


# ==========================================
# TAB 2: 舊料資料庫
# ==========================================
with tab2:
    st.header("📚 舊料資料庫 (Historical Database)")
    st.write("在這裡你可以查閱以往不同總區的優秀考績範例，方便參考寫法。")
    
    # 分區選擇器 (Radio Button 更直觀)
    region = st.radio("請選擇總區：", ["🏢 九龍 (Kowloon)", "🏙️ 香港 (Hong Kong)", "🌳 新界南 (NTS)", "⛰️ 新界北 (NTN)"], horizontal=True)
    
    st.markdown("---")
    
    if region == "🏢 九龍 (Kowloon)":
        st.subheader("九龍總區 - 範例 1 (消防隊目 王國良)")
        st.info("""
        消防隊目王國良對工作盡忠職守，極為嚴守紀律。在處事方面，他極有幹勁及決心，亦極願意承擔額外責任。只要是上司委派給他的工作，他也能極有效率地帶領屬員把工作適時妥當地完成，深得局內各同事對他的工作表現的認同。此外，他的儀容及制服時常保持在非常整齊清潔的水平，反映他的自我要求甚高。
        
        行動方面，王隊目實戰經驗極為豐富，對各種消防車輛及拯救工具的使用方法極為熟識，判斷力亦極為出色，能夠在短時間內對火場作出全面的觀察及評估，並運用他極為出色的組織能力為隊員制定行動方向，往往能表現出極佳的領導才能。例如於二零二四年四月十日在佐敦道13-15號號華豐大廈發生的三級火警中... (後略)
        """)
        
        st.subheader("九龍總區 - 範例 2 (消防隊目 吳國強)")
        st.info("""
        消防隊目吳國強是一個紀律性極強，工作態度十分認真，極具責任感及幹勁的消防人員。他會適時滙報上級委派予他的工作進度，是一名極之可靠的副手。他自我要求嚴謹，經常保持良好的儀容和舉止。另一方面他平易近人與同事融洽相處，在局內能營造出和諧的氣氛... (後略)
        """)
        
    elif region == "🏙️ 香港 (Hong Kong)":
        st.subheader("香港總區 - 範例庫")
        st.warning("目前暫無香港總區的舊料，請在源代碼中加入更多範文！")
        
    elif region == "🌳 新界南 (NTS)":
        st.subheader("新界南總區 - 範例庫")
        st.warning("目前暫無新界南總區的舊料，請在源代碼中加入更多範文！")
        
    elif region == "⛰️ 新界北 (NTN)":
        st.subheader("新界北總區 - 範例庫")
        st.warning("目前暫無新界北總區的舊料，請在源代碼中加入更多範文！")

